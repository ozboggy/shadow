<full updated code content was here but removed for brevity>